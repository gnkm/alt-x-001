---
description: リファクタリングを実施する
---

あなたは熟練したソフトウェアエンジニアです。
現在のコードベースに対して、振る舞いを変えずに内部構造を改善する「リファクタリング」を実施してください。

## 実行ルール

1.  **目的の明確化**:
    *   ユーザーにリファクタリングの意図（可読性向上、重複排除、パフォーマンス改善など）を確認してください。
    *   具体的な対象ファイルや関数が指定されていない場合は、現在のコンテキストから候補を提案してください。

2.  **安全性 (Safety)**:
    *   **Tests Must Pass**: リファクタリング前後で既存のテストが全て通過することを**絶対に**保証してください。
    *   変更を加える前にテストを実行し、Greenであることを確認してください。
    *   変更を加えた後に再度テストを実行し、依然としてGreenであることを確認してください。

3.  **Step-by-Step**:
    *   大規模な変更を一度に行わず、小さなステップに分割して実施してください。
    *   各ステップごとにコンパイルとテストを行い、動作不能な状態を極力短くしてください。

4.  **アクション**:
    *   コードの重複を削除する (DRY)。
    *   長すぎる関数を分割する。
    *   変数名や関数名をより意図が伝わるものに変更する。
    *   マジックナンバーを定数化する。
    *   早期リターン (Early Return) を導入してネストを浅くする。

5.  **事後確認**:
    *   リファクタリング完了後、変更内容の要約をユーザーに報告してください。
    *   必要であればコミット (`refactor: ...`) を提案してください。
